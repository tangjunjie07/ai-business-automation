# 財務自動化システム (Accounting Automation System) - 統合仕様ドキュメント

## 1. システム概要
本システムは、Next.js (前端)、Python (后台)、Azure AIを組み合わせ、単なるデータ入力の自動化にとどまらず、**「会計上の正当性確認」**および**「不正・誤振込の防止（ガバナンス強化）」**をエンドツーエンドで実現します。

---

## 2. 業務フローとAIの具体的役割

### フェーズ 1：データ収集と解析 (解析・抽出)
**【AIの役割：創造・抽出】**
* **プロセス**: ユーザーがアップロードしたPDF/画像から、Azure OCRがテキスト・金額・表構造を抽出。Azure OpenAIが勘定科目やプロジェクトを推論します。
* **アウトプット**: 書類から仕訳の「案」を自動生成。

### フェーズ 2：仕訳作成とシステム連携 (検証・補完)
**【AIの役割：会計上の正当性チェック】**
単にデータを送るだけでなく、AIが以下のガバナンスチェックを行います。
1. **税区分の自動判定**: 
   OCRで取得した品目名から、標準税率(10%)、軽減税率(8%)、あるいは対象外（住民税等）かをAIが最終判定します。
2. **仕訳の二重チェック**: 
   「過去に同じ取引先・金額の仕訳がすでに登録されていないか？」をAIが検索し、重複リスクを警告します。

### フェーズ 3：振込実行と最終確認 (監査・防犯)
**【AIの役割：異常検知（アノマリー検知）】**
Scikit-learn等の機械学習を用い、事故を未然に防ぎます。
1. **振込先の厳密検証**: 
   請求書の口座番号が過去の履歴やマスタと1文字でも違えば即座にアラート。**ビジネスメール詐欺（請求書差し替え）**を強力に防御します。
2. **支出のトレンド分析**: 
   「特定拠点の外注費が過去3ヶ月平均より50%急増している」といった経営的な示唆を承認画面に表示します。

---

## 3. AIが必要な理由（ガバナンスの観点）
フェーズ2・3でAIを導入する最大の理由は、**「人間は慣れてくると確認が疎かになるから」**です。

* **人間**: 大量のリストがあると、つい「全部OK」と流れ作業で承認してしまう。
* **AI**: 1,000件あっても1件の「口座名義のわずかな違い」や「重複」を見逃さず、常に一定の基準で監査を継続できる。

---

## 4. 役割分担まとめ（責務表）

| レイヤー | 担当機能 | 処理内容とAIの役割 |
| :--- | :--- | :--- |
| **ユーザー (Web前端)** | 意思決定・入力 | ファイル添付、補足入力、AI結果の修正、最終承認 |
| **前端 (Next.js)** | 表示・通信制御 | WebSocketでの進捗表示、チャットUI管理、状態保持 |
| **后台 (Python)** | 司令塔・変換 | 認証、API連携、**異常検知アルゴリズムの実行** |
| **Azure (OCR/AI)** | 解析・推論 | 文字のデジタル化、勘定科目の決定、文脈の理解 |
| **ML Engine (AI系)** | 監査・分析 | **税区分判定、重複チェック、詐欺検知、トレンド分析** |

---

## 5. まとめ：各フェーズの「AIの仕事」

| フェーズ | AIの役割 | 具体的なアウトプット |
| :--- | :--- | :--- |
| **P1: 解析** | 創造・抽出 | 書類から文字を読み取り、仕訳の**「案」**を作る |
| **P2: 仕訳** | 検証・補完 | 税区分や重複をチェックし、システムへ**「安全」**に届ける |
| **P3: 振込** | 監査・防犯 | 口座相違や支出異常を検知し、不正支払いを**「阻止」**する |

---

## 6. 実装に向けたアドバイス
* **エラーハンドリング**: 外部API（Azure, MF, 銀行）がダウンした際の**リトライ処理**が運用の安定性に直結します。
* **異常検知の学習**: Phase 3の精度向上のため、正常な振込履歴を学習データとして構造化して蓄積する設計にしてください。